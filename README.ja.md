# マテリアルベイカー

> [!NOTE]
> このバージョンはプレリリース版であり、現在開発中です。

プロシージャルマテリアルをテクスチャにベイクするための、無料で使いやすいUnreal Engineプラグインです。個人開発者や小規模チームでの利用に最適化されており、シンプルで効率的なワークフローを提供します。

## 機能

*   **多様なプロパティのベイク:** 幅広いマテリアルプロパティをベイクできます:
    *   Final Color (最終的な色)
    *   Base Color (ベースカラー)
    *   Normal (法線)
    *   Roughness (ラフネス)
    *   Metallic (メタリック)
    *   Specular (スペキュラ)
    *   Opacity (オパシティ)
    *   Emissive Color (エミッシブカラー)
*   **柔軟な出力形式:** ベイクしたテクスチャを **Texture Asset**, **PNG**, **JPEG**, **TGA**, **EXR** ファイルとして保存できます。なお、JPEGファイルは常に8-bitで保存されます。
*   **ビット深度の選択:** プロジェクトのニーズに合わせて **8-bit** と **16-bit** の出力形式を選択できます。
*   **ベイクキュー:** 複数のマテリアルをキューに追加し、一括でベイク処理できます。
*   **キューの更新:** キュー内のアイテムを選択して、設定を更新できます。
*   **自動命名とパス提案:** 選択したマテリアルに基づいて、テクスチャ名と出力パスを自動的に提案します。さらに、マテリアルのプレフィックス `M_` や `MI_` をテクスチャ用の `T_` に自動的に変更するなど、一般的な命名規則にも従います。
*   **自動サフィックス:** 選択したプロパティに応じて、テクスチャ名に関連するサフィックス（例: Normalの場合は `_N`、Base Colorの場合は `_BC`）を自動的に追加し、重複したサフィックスの追加を防ぎます。この機能は無効化できます。

| プロパティ | サフィックス |
| --- | --- |
| Base Color | `_BC` |
| Normal | `_N` |
| Roughness | `_R` |
| Metallic | `_M` |
| Emissive Color | `_E` |
| Opacity | `_O` |
*   **カスタムテクスチャサイズ:** 出力するテクスチャの幅と高さを自由に設定できます（最大8192x8192）。
*   **圧縮設定:** テクスチャアセットに適した圧縮形式を選択できます。
*   **sRGB切り替え:** 色の正確性を保つためにsRGBの有効/無効を切り替えられます。
*   **詳細な進捗表示:** ベイク処理中に詳細な進捗状況を表示します。

## 想定ユーザー

*   **Substance Desinerを導入することが難しい個人、小規模開発者**
*   **UnrealEngine5上でプロシージャルマテリアルをつくり、テクスチャを作ることを気軽に試したい人**
*   **UnrealEngine内で長年プロシージャルマテリアルを作りすぎて、いまさらひとつづつベイクするのが大変な、私のような人**

## 使い方

### 1. ツールの起動

1.  Unreal Engineエディタのメインツールバーに移動します。
2.  **「Tools > Material Baker」** をクリックして、プラグインウィンドウを開きます。

### 2. ベイク設定

**「Bake Settings」** タブで、各ベイクジョブのパラメータを定義します。

1.  **Property to Bake (ベイクするプロパティ):** エクスポートしたいマテリアルチャンネル（例: Base Color, Normal, Roughness）を選択します。
2.  **Bit Depth (ビット深度):** 標準的なテクスチャには **8-bit** を、より高い色/データ精度を持つ高品質なテクスチャには **16-bit** を選択します。
3.  **Target Material (対象マテリアル):** ドロップダウンからベイクしたいマテリアルを選択します。選択すると、出力名とパスが自動的に提案されます。
4.  **Baked Texture Name (ベイク後のテクスチャ名):** 出力テクスチャの名前を割り当てます。
5.  **Bake Texture Size (ベイクテクスチャのサイズ):** ベイクするテクスチャの解像度（幅と高さ）を設定します。
6.  **Compression Setting (圧縮設定):** (テクスチャアセット用) 圧縮形式を選択します。`TC_Default` はほとんどのカラーテクスチャに適しており、`TC_Normalmap` は法線マップに最適です。
7.  **sRGB:** カラーテクスチャ（Base Color, Final Color）では有効にします。法線、ラフネス、メタリックなどのリニアデータマップでは、正確な結果を得るために無効にします。
8.  **Output Type (出力タイプ):**
    *   **Texture Asset:** プロジェクトのコンテンツフォルダ内に `UTexture` アセットを作成します。これが最も一般的な選択肢です。
    *   **PNG, JPEG, TGA:** テクスチャを画像ファイルとして、PC上の指定した場所にエクスポートします。
9.  **Output Path (出力パス):**
    *   **Texture Asset** の場合、プロジェクトの `/Game/` ディレクトリ内のパス（例: `/Game/Textures/MyBakes`）を指定します。
    *   画像ファイルの場合、システム上の絶対パス（例: `D:/MyProject/Exports`）を指定します。

### 3. ベイクキューの管理

**「Bake Queue」** タブで、処理するジョブのリストを管理します。

1.  **Add to Queue (キューに追加):** **「Bake Settings」** タブでジョブを設定した後、**「Add to Queue」** をクリックします。ジョブがベイクキューのリストに表示されます。
2.  **Update Selected (選択項目を更新):** キューに既にあるジョブを修正するには、リストからそのジョブを選択します。**「Bake Settings」** タブにそのデータが読み込まれるので、変更を加えてから **「Update Selected」** をクリックして保存します。
3.  **Remove Selected (選択項目を削除):** キューからジョブを削除するには、そのジョブを選択して **「Remove Selected」** をクリックします。

### 4. ベイクの実行

1.  キューの準備ができたら、**「Bake All」** ボタンをクリックします。
2.  プラグインが各ジョबを処理する間、プログレスバーが表示されます。
3.  完了すると、ベイクされたテクスチャは各ジョブで指定した出力パスで利用可能になります。

## Tips

### SDF (Signed Distance Field) のベイク

SDF (Signed Distance Field) は、形状の内側を負の値、外側を正の値で表現することがよくあります。このデータを正しくベイクし、負の値を失わない（0にクランプされない）ようにするためには、高精度かつリニアなフォーマットを使用する必要があります。

`Emissive Color` プロパティは、トーンマッピングを適用せずにHDR（ハイダイナミックレンジ）の値を処理するように設計されているため、この目的に最適です。

**推奨設定:**

*   **マテリアル設定:** マテリアル内で、SDFの計算結果を **Emissive Color** の出力ピンに接続します。
*   **Property:** `Emissive Color`
*   **Bit Depth:** `16-bit`
*   **Output Type:** `Texture Asset` （浮動小数点フォーマットでデータが保存されることを保証します）。
*   **sRGB:** `無効`（チェックを外す）。SDFデータはリニアであり、ガンマ補正を適用するべきではありません。

## 要件

*   Unreal Engine 5.3 以降

## インストール

1.  [リリースページ](https://github.com/embarrassingmoment/MatBaker/releases)から最新のリリースをダウンロードします。
2.  お使いのUnreal Engineプロジェクトのルートディレクトリに移動します。
3.  `Plugins` フォルダが存在しない場合は作成します。
4.  ダウンロードしたアーカイブを `Plugins` フォルダに展開します。
5.  Unreal Engineエディタを再起動します。プラグインが **[Tools] > [Material Baker]** から利用できるようになっているはずです。

## 仕組み

Material Bakerは、ベイク対象のプロパティに応じて2つの異なる方式を使い分けています。

*   **直接描画 (`Final Color`):** `Final Color`プロパティは、`DrawMaterialToRenderTarget`という非常に効率的な方法を使い、マテリアルの最終的な出力を直接テクスチャに描き込みます。これにより、ライティングやポストプロセスエフェクトを含んだ、見た目通りの結果をキャプチャします。
*   **シーンキャプチャ (その他のプロパティ):** `Base Color`や`Normal`など、`Final Color`以外のすべてのプロパティでは、シーンキャプチャ方式が使用されます。この方式では、シーン内に一時的に平らな平面メッシュを配置し、そこに対象のマテリアルを適用した上で、`SceneCapture2D`コンポーネントを用いて特定のG-Bufferやマテリアルプロパティを撮影します。これにより、特定のデータチャンネルを分離して抽出できますが、標準化された形状の上でベイクされるという制限が伴います。

## 制限事項

*   **平面メッシュ上でのベイク:** `Final Color`を除くすべてのプロパティでは、ベイク処理は標準の平らな平面メッシュ上で行われます。これは、特定のメッシュのUVレイアウトやジオメトリに依存する複雑なマテリアルエフェクトが、期待通りにキャプチャされない可能性があることを意味します。このツールは、プロシージャルまたはタイリング可能なマテリアル定義をベイクするために設計されており、あるメッシュから別のメッシュへテクスチャを転写する（テクスチャリプロジェクションツールのような）目的には適していません。
*   **Opacityの出力:** `Opacity`プロパティをベイクすると、生成されるテクスチャは、不透明度の値がR, G, B, Alphaの各チャンネルにコピーされたグレースケール画像になります。

## バグ報告・機能要望

バグを発見した場合や機能の要望がある場合は、GitHubリポジトリの[イシュー](https://github.com/embarrassingmoment/MatBaker/issues)からご報告ください。

## 開発

このプラグインは、AIソフトウェアエンジニア「Jules」の支援を受けて開発されました。これは、ソフトウェア開発におけるAI利用の透明性を推進するための開示です。

### AIエージェント向けの注記

このリポジトリのルートには、AIソフトウェアエンジニア向けの開発ガイドラインやプロジェクト固有の指示を記載した `AGENTS.md` ファイルが含まれています。何らかの変更を加える前には、このファイルを確認してください。現在、このファイルは日本語のみで提供されています。

## ライセンス

このプラグインは [MITライセンス](LICENSE) の下で提供されています。
